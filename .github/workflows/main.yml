name: main workflow

on:
  push:
    branches:
      - main

jobs:
  version-or-publish:
    uses: ./.github/workflows/covector-version-or-publish.yml
    secrets: inherit

  publish-to-auto-release:
    needs: version-or-publish
    if: needs.version-or-publish.outputs.release-id
    uses: ./.github/workflows/publish-to-auto-release.yml
    secrets: inherit
    with:
      release-id: ${{ needs.version-or-publish.outputs.release-id }}
      matrix: ${{ needs.version-or-publish.outputs.matrix }}

  post-publish:
    needs: version-or-publish
    if: needs.version-or-publish.outputs.command-ran == 'publish'
    name: Post-Publish ${{ matrix.package }}
    runs-on: ubuntu-latest
    permissions:
      contents: write
    strategy:
      fail-fast: false
      matrix: ${{ fromJson(needs.version-or-publish.outputs.packages-published) }}
    steps:
      - run: echo "Running job for package ${{ matrix.package }}""
